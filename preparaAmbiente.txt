kubectl apply -f kafka.yaml
kubectl apply -f mysql.yaml

kubectl get pods | grep mysql | awk '{ print "kubectl exec -ti " $1 " bash " } '

#Cria o banco de dados
mysql -uroot -p160493
create database contas;
exit;
exit

# reinicia pods conta-corrente e senha para criar as tabelas
kubectl get pods | grep conta | awk '{ print "kubectl delete pod " $1 } ' | bash
kubectl get pods | grep senha | awk '{ print "kubectl delete pod " $1 } ' | bash

kubectl get pods | grep mysql | awk '{ print "kubectl exec -ti " $1 " bash " } '

#Cria os registros de testes
mysql -uroot -p160493
use contas;
insert into conta_corrente (agencia,conta,bloqueada, saldo, titular) values ( 10,10,false, 100000, 'Richard Marques');
insert into conta_corrente (agencia,conta,bloqueada, saldo, titular) values ( 10,11,false, 200000, 'Rafael Camilo');
insert into conta_corrente (agencia,conta,bloqueada, saldo, titular) values ( 10,12,false, 500000, 'Jean Anami');
insert into conta_corrente (agencia,conta,bloqueada, saldo, titular) values ( 10,13,false, 100000, 'Marcelo Dias');

insert into senha  select id_conta, '123456' from conta_corrente;

exit;
exit

kubectl get pods | grep kafka | awk '{ print "kubectl exec -ti " $1 " bash " } '


# sobe imagem docker j√° com os dados
 docker run -d --name mysql1 -e MYSQL_ROOT_PASSWORD=160493 -e MYSQL_DATABASE=contas -p 3306:3306 itau/mysql-tef:1.0

# cria rede kafka
 docker network create kafka
 docker run --net=kafka -d --name=zookeeper -e ZOOKEEPER_CLIENT_PORT=2181 confluentinc/cp-zookeeper:4.1.0


 # sobe jaeger
 docker run -d --name=jaeger -p 16686:16686 -p 14268:14268 -p 14250:14250 -p 6831-6832:6831-6832/udp -p 5775:5775/udp jaegertracing/all-in-one
